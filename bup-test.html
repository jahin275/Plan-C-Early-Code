<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUP FBS Mock Test - Test Interface</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #f5f7fa; min-height: 100vh; }
        .test-header { background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%); color: white; padding: 15px 30px; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
        .test-title h1 { font-size: 1.5rem; margin-bottom: 5px; }
        .test-info { display: flex; gap: 30px; align-items: center; }
        .timer-container { background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 25px; display: flex; align-items: center; gap: 10px; }
        .timer { font-size: 1.8rem; font-weight: bold; font-family: 'Courier New', monospace; }
        .timer.warning { color: #ffeb3b; animation: pulse 1s infinite; }
        .timer.danger { color: #ff5252; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.7; } }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .avatar { width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #1a2980; font-weight: bold; font-size: 1.2rem; }
        .container { max-width: 1200px; margin: 100px auto 30px; padding: 0 20px; display: flex; gap: 30px; }
        .question-panel { flex: 3; background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); padding: 30px; }
        .question-navigation { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f0f0f0; }
        .question-counter { font-size: 1.2rem; color: #333; font-weight: 600; }
        .nav-buttons { display: flex; gap: 10px; }
        .nav-btn { background: #f0f7ff; border: 2px solid #1a2980; color: #1a2980; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .nav-btn:hover:not(:disabled) { background: #1a2980; color: white; }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .question-content { margin-bottom: 30px; }
        .question-text { font-size: 1.1rem; line-height: 1.6; margin-bottom: 25px; color: #333; padding: 20px; background: #f9f9f9; border-radius: 10px; border-left: 4px solid #1a2980; }
        .options-container { display: flex; flex-direction: column; gap: 15px; }
        .option { background: #f8f9fa; border: 2px solid #e0e0e0; border-radius: 10px; padding: 18px 20px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 15px; }
        .option:hover { background: #f0f7ff; border-color: #1a2980; transform: translateY(-2px); box-shadow: 0 3px 10px rgba(26,41,128,0.1); }
        .option.selected { background: #1a2980; border-color: #1a2980; color: white; }
        .option-letter { width: 36px; height: 36px; background: #e0e0e0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #333; transition: all 0.3s; }
        .option.selected .option-letter { background: white; color: #1a2980; }
        .option-text { flex: 1; font-size: 1rem; }
        .side-panel { flex: 1; display: flex; flex-direction: column; gap: 20px; }
        .progress-card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); }
        .progress-title { font-size: 1.2rem; color: #333; margin-bottom: 20px; font-weight: 600; }
        .progress-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-box { background: #f0f7ff; padding: 15px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 1.8rem; font-weight: bold; color: #1a2980; margin-bottom: 5px; }
        .stat-label { font-size: 0.85rem; color: #666; }
        .question-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 20px; }
        .grid-item { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; transition: all 0.3s; border: 2px solid #e0e0e0; background: white; }
        .grid-item:hover { transform: scale(1.1); }
        .grid-item.answered { background: #4CAF50; color: white; border-color: #4CAF50; }
        .grid-item.current { background: #1a2980; color: white; border-color: #1a2980; }
        .grid-item.marked { background: #FFC107; color: #333; border-color: #FFC107; }
        .submit-card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); text-align: center; }
        .submit-btn { background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%); color: white; border: none; padding: 16px 40px; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; width: 100%; margin-bottom: 15px; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 7px 20px rgba(26,41,128,0.3); }
        .warning-text { color: #666; font-size: 0.9rem; margin-top: 10px; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 15px; padding: 40px; max-width: 500px; width: 90%; text-align: center; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-50px); } to { opacity: 1; transform: translateY(0); } }
        .modal-icon { font-size: 4rem; color: #1a2980; margin-bottom: 20px; }
        .modal h2 { color: #333; margin-bottom: 15px; }
        .modal p { color: #666; margin-bottom: 25px; line-height: 1.6; }
        .modal-buttons { display: flex; gap: 15px; justify-content: center; }
        .modal-btn { padding: 12px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .modal-btn.cancel { background: #f0f0f0; color: #333; border: none; }
        .modal-btn.cancel:hover { background: #e0e0e0; }
        .modal-btn.confirm { background: #1a2980; color: white; border: none; }
        .modal-btn.confirm:hover { background: #16267a; }
        @media (max-width: 992px) { .container { flex-direction: column; } .test-info { flex-direction: column; gap: 15px; align-items: flex-start; } .header-content { flex-direction: column; gap: 15px; align-items: flex-start; } }
        @media (max-width: 768px) { .question-grid { grid-template-columns: repeat(4, 1fr); } .progress-stats { grid-template-columns: 1fr; } .test-header { padding: 15px; } }
        @media (max-width: 480px) { .question-grid { grid-template-columns: repeat(3, 1fr); } .nav-buttons { flex-direction: column; width: 100%; } .nav-btn { width: 100%; } .modal-buttons { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="test-header">
        <div class="header-content">
            <div class="test-title">
                <h1>BUP FBS Mock Test - 01</h1>
                <p>Bangladesh University of Professionals</p>
            </div>
            <div class="test-info">
                <div class="timer-container">
                    <i class="fas fa-clock"></i>
                    <div class="timer" id="timer">60:00</div>
                </div>
                <div class="user-info">
                    <div class="avatar" id="userAvatar">U</div>
                    <div>
                        <div id="userName">Loading...</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Test ID: <span id="testId">---</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="question-panel">
            <div class="question-navigation">
                <div class="question-counter">
                    Question <span id="currentQuestion">1</span> of <span id="totalQuestions">30</span>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" id="prevBtn" onclick="prevQuestion()">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="nav-btn" id="nextBtn" onclick="nextQuestion()">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <div class="question-content">
                <div class="question-text" id="questionText">
                    Loading question...
                </div>

                <div class="options-container" id="optionsContainer">
                    <!-- Options will be populated by JavaScript -->
                </div>
            </div>

            <div class="question-actions">
                <button class="nav-btn" onclick="markForReview()" id="markBtn">
                    <i class="fas fa-flag"></i> Mark for Review
                </button>
            </div>
        </div>

        <div class="side-panel">
            <div class="progress-card">
                <h3 class="progress-title">Progress</h3>
                
                <div class="progress-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="answeredCount">0</div>
                        <div class="stat-label">Answered</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="markedCount">0</div>
                        <div class="stat-label">Marked</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="unansweredCount">30</div>
                        <div class="stat-label">Unanswered</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">60:00</div>
                        <div class="stat-label">Time Left</div>
                    </div>
                </div>

                <h3 class="progress-title">Questions</h3>
                <div class="question-grid" id="questionGrid">
                    <!-- Question grid will be populated by JavaScript -->
                </div>
            </div>

            <div class="submit-card">
                <button class="submit-btn" onclick="showSubmitModal()">
                    <i class="fas fa-paper-plane"></i> Submit Test
                </button>
                <p class="warning-text">
                    <i class="fas fa-exclamation-triangle"></i> 
                    Test will auto-submit when timer reaches 00:00
                </p>
            </div>
        </div>
    </div>

    <div class="modal" id="submitModal">
        <div class="modal-content">
            <div class="modal-icon">
                <i class="fas fa-paper-plane"></i>
            </div>
            <h2>Submit Test?</h2>
            <p>Are you sure you want to submit your test? You have answered <span id="finalAnsweredCount">0</span> out of 30 questions.</p>
            <p>Once submitted, you cannot make any changes.</p>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="hideSubmitModal()">Cancel</button>
                <button class="modal-btn confirm" onclick="submitTest()">Yes, Submit</button>
            </div>
        </div>
    </div>

    <div class="modal" id="timeUpModal">
        <div class="modal-content">
            <div class="modal-icon">
                <i class="fas fa-clock"></i>
            </div>
            <h2>Time's Up!</h2>
            <p>Your 60 minutes have elapsed. The test is being submitted automatically.</p>
            <p>Calculating your results...</p>
        </div>
    </div>

    <script>
        // Configuration
        const TOTAL_QUESTIONS = 30;
        const TOTAL_TIME = 60 * 60 * 1000; // 60 minutes
        const CORRECT_MARK = 1;
        const WRONG_PENALTY = 0.5;
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyFD7VlgyogVJum_WzJ4NW-UzT7vvK4Psp10s1m8sNbHAVqi_YQREqxRPHC58R-ahJR0w/exec';

        // Test State
        let currentQuestion = 0;
        let answers = new Array(TOTAL_QUESTIONS).fill(null);
        let markedQuestions = new Array(TOTAL_QUESTIONS).fill(false);
        let testStartTime = null;
        let timeRemaining = TOTAL_TIME;
        let timerInterval = null;
        let userData = null;

        // Sample Questions Database (30 questions)
        const questions = [
            {
                id: 1,
                subject: 'Mathematics',
                text: 'What is the value of \\(x\\) in the equation \\(2x + 5 = 15\\)?',
                options: ['A) 3', 'B) 5', 'C) 7.5', 'D) 10'],
                correctAnswer: 1, // B
                explanation: 'Subtract 5 from both sides: 2x = 10, then divide by 2: x = 5'
            },
            {
                id: 2,
                subject: 'Mathematics',
                text: 'What is the area of a rectangle with length 8 cm and width 5 cm?',
                options: ['A) 13 cm²', 'B) 26 cm²', 'C) 40 cm²', 'D) 80 cm²'],
                correctAnswer: 2, // C
                explanation: 'Area = length × width = 8 × 5 = 40 cm²'
            },
            {
                id: 3,
                subject: 'English',
                text: 'Choose the correct synonym for "BENEVOLENT":',
                options: ['A) Cruel', 'B) Kind', 'C) Selfish', 'D) Greedy'],
                correctAnswer: 1, // B
                explanation: 'Benevolent means kind and charitable'
            },
            {
                id: 4,
                subject: 'English',
                text: 'Which sentence is grammatically correct?',
                options: ['A) She don\'t like apples', 'B) She doesn\'t likes apples', 'C) She doesn\'t like apples', 'D) She not like apples'],
                correctAnswer: 2, // C
                explanation: 'Correct form: Subject (she) + doesn\'t + base verb (like)'
            },
            {
                id: 5,
                subject: 'General Knowledge',
                text: 'What is the capital of Bangladesh?',
                options: ['A) Chittagong', 'B) Dhaka', 'C) Khulna', 'D) Sylhet'],
                correctAnswer: 1, // B
                explanation: 'Dhaka has been the capital since 1971'
            },
            {
                id: 6,
                subject: 'General Knowledge',
                text: 'Who is known as the father of the nation in Bangladesh?',
                options: ['A) Sheikh Hasina', 'B) Ziaur Rahman', 'C) Bangabandhu Sheikh Mujibur Rahman', 'D) Hossain Mohammad Ershad'],
                correctAnswer: 2, // C
                explanation: 'Bangabandhu Sheikh Mujibur Rahman led Bangladesh to independence'
            },
            {
                id: 7,
                subject: 'Mathematics',
                text: 'Simplify: \\(3^2 + 4^2\\)',
                options: ['A) 7', 'B) 12', 'C) 25', 'D) 49'],
                correctAnswer: 2, // C
                explanation: '3² = 9, 4² = 16, 9 + 16 = 25'
            },
            {
                id: 8,
                subject: 'English',
                text: 'Choose the correct spelling:',
                options: ['A) Accomodate', 'B) Accommodate', 'C) Acommodate', 'D) Accomadate'],
                correctAnswer: 1, // B
                explanation: 'Accommodate has double c and double m'
            },
            {
                id: 9,
                subject: 'Mathematics',
                text: 'If a triangle has angles 60° and 70°, what is the third angle?',
                options: ['A) 40°', 'B) 50°', 'C) 60°', 'D) 70°'],
                correctAnswer: 1, // B
                explanation: 'Sum of angles = 180°, so 180 - (60 + 70) = 50°'
            },
            {
                id: 10,
                subject: 'General Knowledge',
                text: 'What is the currency of Japan?',
                options: ['A) Yen', 'B) Won', 'C) Yuan', 'D) Ringgit'],
                correctAnswer: 0, // A
                explanation: 'Japanese Yen is the official currency'
            }
        ];

        // Add 20 more sample questions to reach 30
        for (let i = 11; i <= 30; i++) {
            questions.push({
                id: i,
                subject: i <= 20 ? 'Mathematics' : i <= 25 ? 'English' : 'General Knowledge',
                text: `Sample question ${i}: What is ${i} + ${i}?`,
                options: [`A) ${i*2-2}`, `B) ${i*2}`, `C) ${i*2+2}`, `D) ${i*2+4}`],
                correctAnswer: 1, // B
                explanation: `${i} + ${i} = ${i*2}`
            });
        }

        // Initialize Test
        function initializeTest() {
            const storedData = localStorage.getItem('bup_test_user');
            if (!storedData) {
                alert('No registration data found. Please register first.');
                window.location.href = 'bup-registration.html';
                return;
            }

            userData = JSON.parse(storedData);
            testStartTime = userData.startTime || Date.now();

            document.getElementById('userName').textContent = userData.name;
            document.getElementById('testId').textContent = userData.testId;
            document.getElementById('userAvatar').textContent = userData.name.charAt(0).toUpperCase();

            renderQuestion();
            updateProgress();
            updateQuestionGrid();
            startTimer();
            
            setInterval(autoSaveProgress, 30000);
            window.addEventListener('beforeunload', handleBeforeUnload);
        }

        // Timer Functions
        function startTimer() {
            const endTime = testStartTime + TOTAL_TIME;
            
            timerInterval = setInterval(() => {
                timeRemaining = endTime - Date.now();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    timeRemaining = 0;
                    handleTimeUp();
                }
                
                updateTimerDisplay();
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60000);
            const seconds = Math.floor((timeRemaining % 60000) / 1000);
            
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            timerElement.className = 'timer';
            if (timeRemaining < 5 * 60 * 1000) {
                timerElement.classList.add('warning');
            }
            if (timeRemaining < 60 * 1000) {
                timerElement.classList.add('danger');
            }
        }

        function handleTimeUp() {
            document.getElementById('timeUpModal').style.display = 'flex';
            setTimeout(submitTest, 2000);
        }

        // Question Navigation
        function renderQuestion() {
            const question = questions[currentQuestion];
            
            document.getElementById('currentQuestion').textContent = currentQuestion + 1;
            document.getElementById('totalQuestions').textContent = TOTAL_QUESTIONS;
            document.getElementById('questionText').innerHTML = question.text;
            
            if (window.MathJax) {
                MathJax.typeset();
            }
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                if (answers[currentQuestion] === index) {
                    optionElement.classList.add('selected');
                }
                optionElement.onclick = () => selectOption(index);
                
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            document.getElementById('nextBtn').disabled = currentQuestion === TOTAL_QUESTIONS - 1;
            
            const markBtn = document.getElementById('markBtn');
            if (markedQuestions[currentQuestion]) {
                markBtn.innerHTML = '<i class="fas fa-flag"></i> Unmark';
                markBtn.style.background = '#FFC107';
                markBtn.style.color = '#333';
            } else {
                markBtn.innerHTML = '<i class="fas fa-flag"></i> Mark for Review';
                markBtn.style.background = '';
                markBtn.style.color = '';
            }
            
            updateQuestionGrid();
        }

        function selectOption(optionIndex) {
            answers[currentQuestion] = optionIndex;
            renderQuestion();
            updateProgress();
        }

        function markForReview() {
            markedQuestions[currentQuestion] = !markedQuestions[currentQuestion];
            renderQuestion();
            updateProgress();
        }

        function nextQuestion() {
            if (currentQuestion < TOTAL_QUESTIONS - 1) {
                currentQuestion++;
                renderQuestion();
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            }
        }

        // Progress Tracking
        function updateProgress() {
            const answeredCount = answers.filter(a => a !== null).length;
            const markedCount = markedQuestions.filter(m => m).length;
            const unansweredCount = TOTAL_QUESTIONS - answeredCount;
            
            document.getElementById('answeredCount').textContent = answeredCount;
            document.getElementById('markedCount').textContent = markedCount;
            document.getElementById('unansweredCount').textContent = unansweredCount;
            document.getElementById('finalAnsweredCount').textContent = answeredCount;
        }

        function updateQuestionGrid() {
            const grid = document.getElementById('questionGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < TOTAL_QUESTIONS; i++) {
                const item = document.createElement('div');
                item.className = 'grid-item';
                
                if (i === currentQuestion) {
                    item.classList.add('current');
                } else if (markedQuestions[i]) {
                    item.classList.add('marked');
                } else if (answers[i] !== null) {
                    item.classList.add('answered');
                }
                
                item.textContent = i + 1;
                item.onclick = () => {
                    currentQuestion = i;
                    renderQuestion();
                };
                
                grid.appendChild(item);
            }
        }

        // Auto-save
        function autoSaveProgress() {
            if (!userData) return;
            
            const progress = {
                testId: userData.testId,
                answers: answers,
                markedQuestions: markedQuestions,
                currentQuestion: currentQuestion,
                timeRemaining: timeRemaining,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('bup_test_progress', JSON.stringify(progress));
        }

        // Load saved progress
        function loadProgress() {
            const saved = localStorage.getItem('bup_test_progress');
            if (saved) {
                const progress = JSON.parse(saved);
                if (progress.testId === userData.testId) {
                    answers = progress.answers || answers;
                    markedQuestions = progress.markedQuestions || markedQuestions;
                    currentQuestion = progress.currentQuestion || 0;
                    timeRemaining = progress.timeRemaining || timeRemaining;
                }
            }
        }

        // Submit Test
        function showSubmitModal() {
            document.getElementById('submitModal').style.display = 'flex';
        }

        function hideSubmitModal() {
            document.getElementById('submitModal').style.display = 'none';
        }

        function calculateScore() {
            let correct = 0;
            let wrong = 0;
            let unattempted = 0;
            
            answers.forEach((answer, index) => {
                if (answer === null) {
                    unattempted++;
                } else if (answer === questions[index].correctAnswer) {
                    correct++;
                } else {
                    wrong++;
                }
            });
            
            const totalMarks = (correct * CORRECT_MARK) - (wrong * WRONG_PENALTY);
            
            return {
                correct: correct,
                wrong: wrong,
                unattempted: unattempted,
                totalMarks: Math.max(0, totalMarks).toFixed(2),
                percentage: ((totalMarks / TOTAL_QUESTIONS) * 100).toFixed(2)
            };
        }

        async function submitTest() {
            clearInterval(timerInterval);
            document.getElementById('timeUpModal').style.display = 'none';
            hideSubmitModal();
            
            const score = calculateScore();
            const endTime = Date.now();
            const duration = Math.floor((endTime - testStartTime) / 1000);
            
            // Prepare result data
            const resultData = {
                action: 'submit',
                testId: userData.testId,
                name: userData.name,
                email: userData.email,
                phone: userData.phone,
                startTime: new Date(testStartTime).toISOString(),
                endTime: new Date(endTime).toISOString(),
                score: score,
                timestamp: new Date().toISOString()
            };
            
            // Store wrong questions with explanations for results page
            const wrongQuestions = [];
            answers.forEach((answer, index) => {
                if (answer !== null && answer !== questions[index].correctAnswer) {
                    wrongQuestions.push({
                        question: questions[index].text,
                        userAnswer: String.fromCharCode(65 + answer),
                        correctAnswer: String.fromCharCode(65 + questions[index].correctAnswer),
                        explanation: questions[index].explanation
                    });
                }
            });
            
            // Save everything for results page
            localStorage.setItem('bup_test_results', JSON.stringify({
                userData: userData,
                score: score,
                duration: duration,
                wrongQuestions: wrongQuestions,
                submittedAt: new Date().toISOString()
            }));
            
            // Show loading
            document.body.innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);">
                    <div style="text-align: center; color: white; padding: 40px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h1>Submitting Test...</h1>
                        <p>Calculating your results...</p>
                    </div>
                </div>
            `;
            
            // Try to save to Google Sheets
            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(resultData)
                });
                
                // Clear progress data
                localStorage.removeItem('bup_test_progress');
                localStorage.removeItem('bup_test_user');
                
                // Redirect to results
                setTimeout(() => {
                    window.location.href = 'bup-results.html';
                }, 1500);
                
            } catch (error) {
                // Even if Sheets save fails, still show results
                setTimeout(() => {
                    window.location.href = 'bup-results.html';
                }, 1500);
            }
        }

        // Handle beforeunload
        function handleBeforeUnload(e) {
            e.preventDefault();
            e.returnValue = 'Your test progress will be saved.';
            return e.returnValue;
        }

        // Initialize when page loads
        window.onload = function() {
            initializeTest();
            loadProgress();
            renderQuestion();
        };
    </script>
</body>
</html>